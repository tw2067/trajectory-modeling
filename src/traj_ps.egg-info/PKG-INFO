Metadata-Version: 2.4
Name: traj_ps
Version: 0.1.0
Summary: TrajPS: Trajectory-based propensity score modeling (Deep, Bayesian, GAM)
Author: Tammy Wertheimer
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: numpy<2.0,>=1.22
Requires-Dist: pandas>=1.5
Requires-Dist: pyyaml>=6.0
Provides-Extra: deep
Requires-Dist: torch>=2.0; extra == "deep"
Requires-Dist: tqdm>=4.66; extra == "deep"
Provides-Extra: bayes
Requires-Dist: pymc>=5.10; extra == "bayes"
Requires-Dist: arviz>=0.15; extra == "bayes"
Requires-Dist: pytensor>=2.18; extra == "bayes"
Requires-Dist: patsy>=0.5.3; extra == "bayes"
Requires-Dist: joblib>=1.3; extra == "bayes"
Requires-Dist: lifelines>=0.27; extra == "bayes"
Provides-Extra: gam
Requires-Dist: pygam==0.9.0; extra == "gam"
Requires-Dist: scipy<=1.10.1; extra == "gam"
Requires-Dist: numpy<=1.26.4; extra == "gam"
Requires-Dist: joblib>=1.3; extra == "gam"
Requires-Dist: lifelines>=0.27; extra == "gam"
Provides-Extra: all
Requires-Dist: traj_ps[bayes,deep,gam]; extra == "all"

# TrajPS: Trajectory-Based Propensity Score Modeling

Unified interface & data pipeline for trajectory-informed PS using:
- Deep (GRU-D / TCN / Transformer, binned Cox or discrete hazard)
- Bayesian posterior trajectory features
- GAM beta-coefficient covariates

## Quick backend recipes

### Install
```bash
# choose only what you need
pip install -e .[deep]
pip install -e .[bayes]
pip install -e .[gam]
````

### Data config (features & binning)
Edit ```configs/data.yaml```. Example:
```yaml
seed: 920
n_patients: 120
bin_width: 0.0833333333   # monthly
embed_features: ["eGFR", "HbA1c"]   # modeled as trajectories
agg_features:   ["SBP", "MedA"]     # aggregated covariates
```

### Train/Fit and Save
```bash
# Deep (GRU-D + binned Cox head)
python scripts/train.py --backend deep --data_cfg configs/data.yaml --train_cfg configs/deep.yaml

# Bayesian trajectories (posterior feature probabilities → Cox TVF)
python scripts/train.py --backend bayes --data_cfg configs/data.yaml --train_cfg configs/bayes.yaml

# GAM trajectories (windowed β-coefficients → Cox TVF)
python scripts/train.py --backend gam --data_cfg configs/data.yaml --train_cfg configs/gam.yaml
```

### Artifacts
* ```artifacts/deep_cox_binned.pt```
* ```artifacts/bayes_cox_tvf.pkl```
* ```artifacts/gam_cox_tvf.pkl```

### Predict time-varying PS
```bash
# Deep (needs the deep checkpoint)
python scripts/predict_ps.py --backend deep --model_path artifacts/deep_cox_binned.pt \
  --data_cfg configs/data.yaml --out data/ps_deep.parquet --export_embeddings

# Bayesian (needs a saved CoxTVF)
python scripts/predict_ps.py --backend bayes --model_path artifacts/bayes_cox_tvf.pkl \
  --data_cfg configs/data.yaml --train_cfg configs/bayes.yaml --out data/ps_bayes.parquet

# GAM (needs a saved CoxTVF)
python scripts/predict_ps.py --backend gam --model_path artifacts/gam_cox_tvf.pkl \
  --data_cfg configs/data.yaml --train_cfg configs/gam.yaml --out data/ps_gam.parquet
```

## `.gitignore`
```gitignore
__pycache__/
*.pyc
.venv/
.env
/data/
logs/
*.pt
```
